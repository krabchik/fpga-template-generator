# Генератор шаблонных проектов для отладочных плат на основе ПЛИС

Репозиторий содержит шаблонные и конфигурационные файлы для проектов под отладочные платы Altera в САПР Quartus Prime, а также API и веб-интерфейс для генератора шаблонных проектов 

## Требования

 - Python 3.9+
 - requirements.txt

# Шаблонные файлы

Генерируемые файлы проекта создаются на основе конфигурационных и шаблонных файлов в папке ```boards```

Для добавления новой платы нужно:
1. Создать файл board_name.yaml в ```boards```, указать
   1. Производителя (```manufacturer```), семейство (```family```) и модель платы (```device```)
   2. Имя, отображаемое в списке плат (поле ```name```)
   3. Название файла с изображением платы (само изображение помещается в папку ```static/img```)
   4. Папка с шаблонными файлами (если не указано, будет искаться папка по названию платы)
   5. Компоненты платы (```components```), для каждого компонента
      1. Ключ в ```components``` - имя, по которому можно будет обращаться из шаблонов
      2. ```label``` - имя компонента, отображаемое в интерфейсе
      3. ```default``` - использовать ли компонент по умолчанию
      4. ```coordinates``` - список из словарей с координатами компонента на изображении платы (x, y, width, height) (компоненты, например пины для подключения Arduino, могут располагаться в разных частях изображения платы)
   6. Дополнительные параметры (```extras```) для шаблонных файлов
      1. Ключ в ```extras``` - название, по которому можно будет обращаться из шаблонов
      2. ```type``` - тип параметра, доступно ```int```, ```str```, ```bool```
      3. ```default``` - значение параметра по умолчанию (для ```bool``` использовать значения YAML - ```true``` или ```false```)
      4. ```label``` - имя параметра в веб-интерфейсе
2. Добавить шаблонные файлы в соответствующую папку, например ```boards/new-board-name```
   - Для Quartus Prime необходимы файл проекта .qpf, файл назначений пинов .qsf и файл временных ограничений .sdc. Также желательно добавить файл HDL (например, Verilog) с объявлением модуля верхнего уровня и доступных сигналов
   - Чтобы в файлы проекта попадали только выбранные компоненты, их объявления и параметры должны быть обернуты в [условную конструкцию](https://jinja.palletsprojects.com/en/stable/templates/#if) шаблонизатора Jinja2, например
   ```
   {% if components.key -%}
   #============================================================
   # KEY
   #============================================================
   set_instance_assignment -name IO_STANDARD "3.3-V LVTTL" -to KEY[0]
   set_instance_assignment -name IO_STANDARD "3.3-V LVTTL" -to KEY[1]
   set_location_assignment PIN_AH17 -to KEY[0]
   set_location_assignment PIN_AH16 -to KEY[1]
   {%- endif %}
   ```
   - В Verilog файле для удаления последней запятой при добавлении сигналов используется другая форма
   ```
   {% if component_name == 'clock' and component.use -%}
   //////////// CLOCK //////////
   input 		          		FPGA_CLK1_50,
   input 		          		FPGA_CLK2_50,
   input 		          		FPGA_CLK3_50{% if not loop.last%},{% endif %}
   {% endif -%}
   ```
   - Дополнительные параметры (```extras```) можно использовать в шаблонах следующим образом
   ```
   {% if extras.is_virtual -%}
   set_location_assignment PIN_Y25 -to SW[0]
   set_location_assignment PIN_W25 -to SW[1]
   set_location_assignment PIN_W22 -to SW[2]
   set_location_assignment PIN_W21 -to SW[3]
   {%- else -%}
   set_location_assignment PIN_Y24 -to SW[0]
   set_location_assignment PIN_W24 -to SW[1]
   set_location_assignment PIN_W21 -to SW[2]
   set_location_assignment PIN_W20 -to SW[3]
   {%- endif -%}
   ```